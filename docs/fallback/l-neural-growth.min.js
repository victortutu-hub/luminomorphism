(function(){
  class _0xN1uR {
    constructor(){
      this._c = document.createElement(String.fromCharCode(99,97,110,118,97,115));
      this._x = this._c.getContext('2d');
      this._b = [];
      this._s = {
        s:0.6, d:6, a:0.5
      };
    }

    _r(e){
      this._c.width = e.offsetWidth;
      this._c.height = e.offsetHeight;
    }

    _i(e){
      const t = this._c.width/2, r = this._c.height/2;
      this._b = [{
        x:t, y:r, a:-Math.PI/2, d:0, l:2
      }];
    }

    _g(o){
      const l = o.l + this._s.s;
      const X = o.x + l * Math.cos(o.a);
      const Y = o.y + l * Math.sin(o.a);
      if(o.d < this._s.d){
        if(Math.random() < 0.01){
          this._b.push({x:X, y:Y, a:o.a+this._s.a, d:o.d+1, l:1});
          this._b.push({x:X, y:Y, a:o.a-this._s.a, d:o.d+1, l:1});
        } else {
          this._b.push({x:X, y:Y, a:o.a, d:o.d, l:l});
        }
      }
      this._x.beginPath();
      this._x.moveTo(o.x, o.y);
      this._x.lineTo(X, Y);
      this._x.strokeStyle = `rgba(0,255,255,${1 - o.d / this._s.d})`;
      this._x.lineWidth = Math.max(1, 3 - o.d);
      this._x.stroke();
    }

    _a(){
      requestAnimationFrame(()=>this._a());
      for(let i=0;i<this._b.length;i++){
        this._g(this._b[i]);
      }
      this._b = [];
    }

    mount(h){
      this._r(h);
      h.shadowRoot.appendChild(this._c);
      this._i(h);
      this._a();
      window.addEventListener('resize', ()=>this._r(h));
    }
  }

  class LNeuralGrowth extends HTMLElement {
    constructor(){
      super();
      this.attachShadow({mode:'open'});
      this._core = new _0xN1uR();
    }

    connectedCallback(){
      const attr = (n, def, parse) => {
        const v = this.getAttribute(n);
        return v ? parse(v) : def;
      };
      this._core._s.s = attr('growth-speed', 0.6, parseFloat);
      this._core._s.d = attr('max-depth', 6, parseInt);
      this._core._s.a = attr('branching-angle', 0.5, parseFloat);
      this._core.mount(this);
    }
  }

  customElements.define('l-neural-growth', LNeuralGrowth);
})();
